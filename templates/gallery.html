{% extends "master.html" %}
{% block extra_css %}
  <style>
    .container {
      width: 100vw;
      height: 100vh;
      margin: auto;
    }
    .container img {
      display: block;
      max-width: 100%;
      max-height: 100%;
      object-fit: contain;
      margin: auto;
    }
    .navarrow {
      display: block;
      width: 2em;
      height: 2em;
      background-color: transparent;
      position: absolute;
      top: 50%;
      left: 10;
      z-index: -10;
    }
    .navarrow:hover {
      border: 3px solid red;
    }
    .helptext {
      font-style: italic;
      font-size: 75%;
      color: white;
      text-align: center;
    }
	body { 
	  background: #000000; 
	}
  </style>
{% endblock %}

{% block extra_JS %}
  <script>
    document.onkeydown= function(key){ reactKey(key); }
    document.onmousedown= function(foo){ reactMouse(foo); }
    var images = []
    {% for photo in g.photos %}
    images.push("{{ photo }}")
    {% endfor %}
    var num_images = images.length ;

    function navigate(move) {
       var obj = document.getElementById("main");
       var curr_img = obj.src.split(":").slice(-1)[0]
       var curr_pos = images.indexOf(curr_img);
       var new_pos = curr_pos + move;
       if (new_pos >=0 && new_pos < num_images) {
         obj.src = images[new_pos];
       } else {
        obj.src = images[num_images - 1];
       }
    }

	function reactKey(evt) {
	  if(evt.keyCode== 37) {
        navigate(-1);   
	  } else if(evt.keyCode== 39) {
        navigate(1);   
      }
	}

    function reactMouse(evt) {
      var locX = evt.x ;
      var imgWidth = document.getElementById("main").width ;
      var leftQ = imgWidth * .25;
      var rightQ = imgWidth * .75 ;
      if (locX < leftQ) {
        navigate(-1);   
      } else if (locX > rightQ) {
        navigate(1);   
      }
    }

    function getAttrs(obj) {
      var ret = [];
      for (var att in obj) {
        ret.push(att + " ") ;
      }
      return ret ;
    }

	var touchXstart = -1;
    var movement = 0;
	window.addEventListener('load', function(){ // on page load
		document.body.addEventListener('touchstart', function(e){
		  touchXstart = e.changedTouches[0].pageX;
		}, false)
		document.body.addEventListener('touchend', function(e){
		  var endX = e.changedTouches[0].pageX;
          if (endX > touchXstart) {
            movement = -1;
          } else if (endX < touchXstart){
            movement = 1
          }
          navigate(movement);
          touchXstart = -1;
          movement = 0;
		}, false)
        var isMobile = 'ontouchstart' in document.documentElement;
        var navtext = document.getElementById("navtext");
        if (isMobile) {
            navtext.innerHTML = "Swipe left or right to navigate";
        } else {
            navtext.innerHTML = "Use the left and right arrow keys to navigate";
        }
	}, false)
  </script>
{% endblock %}
{% block title %}{{ g.gallery_name }}{% endblock %}

  {% block content %}
  <div>
    <p id="navtext" class="helptext"></p>
  </div>

<!--  <div class="image_display">
  </div>
-->
  <div class="navarrow">
    <span>X</span>
  </div>
    <div class="container">
      <img id="main" src="{{ g.photos[0] }}" />
    </div>
  {% endblock %}
